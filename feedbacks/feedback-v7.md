# Feedback v7 - Checkout Images + Language Switch Bug

**Date:** 2025-12-23
**Priority:** HIGH
**Score:** 12
**Branch:** `claude/implement-assignment-PD1v7`

---

## Bug 1: Checkout Page Images

**Priority:** HIGH

Images not displaying on checkout page: https://k-liee.com/en/checkout

### Root Cause

Same issue as v6 - missing `folder` in image path.

**File:** `src/routes/[lang=locale]/checkout/+page.svelte`

**Line 385 - Current:**
```svelte
src={`/uploads/${item.image.stored_filename}`}
```

**Fix:**
```svelte
src={`/uploads/${item.image.folder || 'products'}/${item.image.stored_filename}`}
```

---

## Bug 2: Language Switch Requires Page Refresh

**Priority:** MEDIUM

### Steps to Reproduce
1. Go to any page (e.g., https://k-liee.com/en/catalog)
2. Click on language switcher (e.g., switch from EN to RU)
3. URL changes to `/ru/catalog`
4. BUT content stays in English until you manually refresh the page

### Expected Behavior
Content should change immediately when language is switched (without page refresh).

### Root Cause Investigation
This is likely a SvelteKit reactivity issue. Possible causes:
1. Language/locale is not reactive in components
2. Data is not re-fetched when locale changes
3. Components use `let` instead of `$derived` for locale-dependent values

### Files to Investigate
- `src/lib/components/layout/LanguageSwitcher.svelte` - how does it navigate?
- `src/routes/[lang=locale]/+layout.svelte` - is locale reactive?
- Page components - do they react to locale changes?

### Possible Fix Approaches

**Option A: Force page reload on language change**
```svelte
// In LanguageSwitcher.svelte
function switchLanguage(newLang) {
  window.location.href = `/${newLang}${currentPath}`;
}
```

**Option B: Make locale reactive (better UX)**
Ensure all components use `$derived` for locale-dependent values:
```svelte
// Instead of:
let title = labels.title[locale];

// Use:
const title = $derived(labels.title[$page.data.locale]);
```

**Option C: Use SvelteKit's invalidate**
```svelte
import { invalidateAll } from '$app/navigation';

async function switchLanguage(newLang) {
  await goto(`/${newLang}${currentPath}`);
  await invalidateAll();
}
```

---

## Files to Modify

1. `src/routes/[lang=locale]/checkout/+page.svelte` - image path fix (line 385)
2. `src/lib/components/layout/LanguageSwitcher.svelte` - investigate/fix language switch
3. Possibly other layout/page components if reactivity issue

---

## Acceptance Criteria

### Bug 1:
- [ ] Checkout page shows product images

### Bug 2:
- [ ] Switching language immediately updates page content
- [ ] No manual page refresh needed

---

## After Completion

```bash
git add .
git commit -m "fix: checkout images + language switch reactivity"
git push origin claude/implement-assignment-PD1v7
```

---

*Generated by Claude Code CLI (Integrator)*
*Workflow v4.2 | 2025-12-23*
