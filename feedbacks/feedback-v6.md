# Feedback v6 - Image Paths: Catalog, Cart Page, Wishlist Page

**Date:** 2025-12-23
**Priority:** HIGH
**Score:** 13
**Branch:** `claude/implement-assignment-PD1v7` (continue on same branch)

---

## Status After v5 Fix

| Page | Images | Status |
|------|--------|--------|
| `/en/shop` | ✅ Working | Fixed in v5 |
| `/en/catalog` | ❌ Broken | **FIX NEEDED** |
| `/en/cart` | ❌ Broken | **FIX NEEDED** |
| `/en/wishlist` | ❌ Broken | **FIX NEEDED** |

---

## Problem 1: Catalog Page (artworks.provider.ts)

**File:** `src/lib/data/artworks.provider.ts`

The provider queries `media.stored_filename` but NOT `media.folder`.

**Current code (line 41):**
```typescript
images.push(`/uploads/${primaryImageFilename}`);
```

**Fix needed:**
1. Add `media.folder` to all SELECT queries (lines ~70, ~105, ~140, etc.)
2. Pass `folder` to `mapArtworkToLocalized` function
3. Use folder in path: `/uploads/${folder}/${filename}`

**Queries to update:**
- `getAllArtworks()` - line ~68
- `getArtworksBySeries()` - line ~105
- `searchArtworks()` - line ~140
- `getAvailableArtworks()` - line ~175
- Any other functions using media

**Example fix for getAllArtworks:**
```typescript
const result = await db
  .select({
    artwork: artworks,
    seriesSlug: series.slug,
    primaryImage: media.stored_filename,
    primaryImageFolder: media.folder  // ADD THIS
  })
  // ... rest of query
```

**Update mapArtworkToLocalized:**
```typescript
function mapArtworkToLocalized(
  artwork: typeof artworks.$inferSelect,
  locale: LanguageCode,
  primaryImageFilename: string | null,
  primaryImageFolder: string | null,  // ADD THIS
  seriesSlug: string | null
): ArtworkLocalized {
  // ...
  if (primaryImageFilename) {
    const folder = primaryImageFolder || 'products';
    images.push(`/uploads/${folder}/${primaryImageFilename}`);
  }
  // ...
}
```

---

## Problem 2: Cart Page

**File:** `src/routes/[lang=locale]/cart/+page.svelte`

**Line 189 - Current:**
```svelte
src={`/uploads/${item.image.stored_filename}`}
```

**Fix:**
```svelte
src={`/uploads/${item.image.folder || 'products'}/${item.image.stored_filename}`}
```

**Note:** Cart API already returns `folder` (fixed in v5).

---

## Problem 3: Wishlist Page

**File:** `src/routes/[lang=locale]/wishlist/+page.svelte`

**Line 242 - Current:**
```svelte
src={`/uploads/${product.image.stored_filename}`}
```

**Fix:**
```svelte
src={`/uploads/${product.image.folder || 'products'}/${product.image.stored_filename}`}
```

**Also check line 121** - where image object is constructed:
```typescript
stored_filename: product.primary_image.stored_filename,
// ADD: folder: product.primary_image.folder,
```

---

## Files to Modify

1. `src/lib/data/artworks.provider.ts` - add folder to queries and path
2. `src/routes/[lang=locale]/cart/+page.svelte` - use folder in path (line 189)
3. `src/routes/[lang=locale]/wishlist/+page.svelte` - use folder in path (line 242, check 121)

---

## Acceptance Criteria

- [ ] `/en/catalog` - images display correctly
- [ ] `/en/cart` - images display correctly (add item to cart first)
- [ ] `/en/wishlist` - images display correctly (add item to wishlist first)
- [ ] `npm run check` - 0 errors
- [ ] `npm run build` - success

---

## After Completion

```bash
git add .
git commit -m "fix: add folder to image paths in catalog, cart, wishlist"
git push origin claude/implement-assignment-PD1v7
```

---

*Generated by Claude Code CLI (Integrator)*
*Workflow v4.2 | 2025-12-23*
