version: '3.8'

services:
  # ========================================
  # FRONTEND SERVICE - SvelteKit
  # ========================================

  frontend:
    build:
      context: ./frontend-sveltekit
      target: development
    container_name: frontend-sveltekit-dev
    ports:
      - "3000:5173"
    environment:
      - NODE_ENV=development
      - ORIGIN=http://localhost:3000
    volumes:
      - ./frontend-sveltekit/src:/app/src
      - ./frontend-sveltekit/static:/app/static
      - ./data:/app/../data
      - /app/node_modules
    depends_on:
      - backend
    networks:
      - app-network
    restart: unless-stopped

  # ========================================
  # BACKEND SERVICE - Express.js
  # ========================================

  backend:
    build:
      context: ./backend-expressjs
      target: development
    container_name: backend-expressjs-dev
    ports:
      - "3001:3001"
    environment:
      - NODE_ENV=development
      - PORT=3001
    volumes:
      - ./backend-expressjs/src:/app/src
      - ./data:/app/data
      - /app/node_modules
    networks:
      - app-network
    restart: unless-stopped

networks:
  app-network:
    driver: bridge

# ========================================
# USAGE / ИСПОЛЬЗОВАНИЕ:
# ========================================
#
# Start full stack (SvelteKit + Express):
#   docker-compose up
#
# Start in detached mode:
#   docker-compose up -d
#
# Stop all services:
#   docker-compose down
#
# View logs:
#   docker-compose logs -f
#
# Rebuild containers:
#   docker-compose up --build
