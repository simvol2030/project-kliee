# Спецификация: Исправление редактирования товаров и мультимедиа в Shop

**Версия:** v2 (структурированный)
**Дата:** 2026-01-08
**Автор:** Moderator → CLI

---

## Сопоставление: Есть сейчас vs Должно быть

| Аспект | Есть сейчас | Должно быть |
|--------|-------------|-------------|
| **Редактирование товаров** | При сохранении выдаёт ошибку, данные не сохраняются | Все поля товара редактируются и сохраняются корректно |
| **Изображения товара** | Только 1 изображение, загрузка не работает | Несколько изображений к каждому товару, загрузка работает |
| **Управление изображениями** | Нельзя добавить/поменять/удалить | Полное управление: добавить, заменить, удалить, сортировать |
| **Галерея на фронтенде** | Одно изображение | Перелистывание нескольких изображений |
| **Видео товара** | Нет возможности | Возможность загрузить видео к товару |
| **Связь медиа с товаром** | Путаница, непонятно что к чему | Чёткая связь: видно какое изображение к какому товару |

**URLs:**
- Фронтенд магазина: https://k-liee.com/ru/shop
- Админка товаров: https://k-liee.com/shop/products

---

## Что на выходе

1. Работающее редактирование товаров в админке — все поля сохраняются без ошибок
2. Мультизагрузка изображений — к каждому товару можно добавить несколько изображений
3. Галерея на фронтенде — пользователь может перелистывать изображения товара
4. Поддержка видео — возможность добавить видео к товару
5. Прозрачная связь медиа — в админке видно какие файлы привязаны к какому товару

---

## Что нужно сделать

1. **Исправить сохранение товаров в админке**
   - Найти и исправить ошибку при сохранении
   - Проверить все поля (название, описание, цена, и т.д.)

2. **Реализовать мультизагрузку изображений**
   - Изменить схему БД для хранения нескольких изображений
   - Создать UI для загрузки нескольких файлов
   - Реализовать сортировку изображений (главное первым)

3. **Добавить управление изображениями в админке**
   - Добавление новых изображений
   - Удаление существующих
   - Замена изображения
   - Изменение порядка

4. **Реализовать галерею на фронтенде**
   - Компонент перелистывания изображений
   - Миниатюры для навигации

5. **Добавить поддержку видео**
   - Загрузка видеофайлов или ссылка на внешнее видео
   - Отображение видео на странице товара

---

## Факторы реализации

- Текущая структура БД (Drizzle ORM, SQLite)
- Существующий компонент загрузки файлов в админке
- Размер файлов — нужны ограничения для изображений и видео
- Форматы файлов — какие поддерживаем (jpg, png, webp, mp4?)
- Производительность — оптимизация изображений при загрузке

---

## Критерии успеха

- [ ] Товар редактируется и сохраняется без ошибок
- [ ] К товару можно добавить 2+ изображений
- [ ] Изображения отображаются в админке с привязкой к товару
- [ ] На фронтенде работает перелистывание изображений
- [ ] Видео загружается и воспроизводится на странице товара
- [ ] Данные сохраняются корректно после перезагрузки страницы

---

## Чек-лист для проверки в браузере

**Админка (https://k-liee.com/shop/products):**
- [ ] Открыть товар на редактирование
- [ ] Изменить название → Сохранить → Проверить что сохранилось
- [ ] Изменить цену → Сохранить → Проверить
- [ ] Добавить 3 изображения → Сохранить → Проверить что все 3 видны
- [ ] Удалить одно изображение → Сохранить → Проверить
- [ ] Изменить порядок изображений → Сохранить → Проверить
- [ ] Добавить видео → Сохранить → Проверить

**Фронтенд (https://k-liee.com/ru/shop):**
- [ ] Открыть страницу товара с несколькими изображениями
- [ ] Перелистнуть изображения (вперёд/назад)
- [ ] Проверить миниатюры (если есть)
- [ ] Проверить воспроизведение видео

---

*v2 — структурированный CLI, передаётся Moderator для комментариев*
