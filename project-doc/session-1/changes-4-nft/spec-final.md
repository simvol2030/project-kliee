# Спецификация: Раздел NFT — полноценное управление NFT коллекцией

**Версия:** FINAL
**Дата:** 2026-01-08
**Автор:** Moderator + CLI
**Статус:** Готово для Developer

---

## Текущее состояние (проверено в браузере и коде)

### Хранение данных

| Компонент | Где сейчас | Что нужно |
|-----------|------------|-----------|
| **NFT данные** | JSON файл `data/nft.json` | Создать таблицу в БД |
| **Таблица nfts** | НЕТ в схеме Drizzle | Создать |
| **Админка NFT** | НЕТ | Создать |
| **Страница отдельного NFT** | НЕТ | Создать |
| **Описание NFT** | НЕТ (только title) | Добавить (4 языка) — ОБЯЗАТЕЛЬНО |
| **Видео NFT** | НЕТ | Добавить — ОБЯЗАТЕЛЬНО |
| **Изображение NFT** | Placeholder | Реальные — ОБЯЗАТЕЛЬНО |

### Структура данных в JSON

**nft.json содержит:**
- 4 NFT (id, title на 4 языках, technique, year, price, currency, image, openSeaUrl)
- Page content (hero, description на 4 языках)
- OpenSea collection info
- SEO данные

**Проблемы:**
- Все NFT используют одно placeholder изображение
- Нет описания работ
- Нет видео
- openSeaUrl = null у всех

### Спарсенные данные (подготовлены)

**Файл:** `project/nft/nft.md`
**5 NFT работ:**
1. Ophelia Hamlet Metamorphosis (описание EN, видео _1_.mp4, OpenSea ссылка)
2. Woman with a pillow (описание EN, видео _2_.mp4, OpenSea ссылка)
3. Squatting down (описание EN, видео _3_.mp4, OpenSea ссылка)
4. Cherry (описание EN, видео _4_.mp4, OpenSea ссылка)
5. Cats (описание EN, видео _5_.mp4, OpenSea ссылка)

**Видео файлы:** `project/nft/_1_.mp4` ... `_5_.mp4`

### Что работает на фронтенде

- Страница `/[lang]/nft` отображается
- 4 NFT карточки (Cats, Squatting Down, Cherry, Metamorphosis)
- Мультиязычность работает (title на 4 языках)
- Светлая/тёмная тема работает
- Ссылка на OpenSea коллекцию

### Что НЕ работает / отсутствует

- **Таблица в БД** — НЕТ
- **Админка** — НЕТ
- **Страница отдельного NFT** — НЕТ (`/[lang]/nft/[id]`)
- **Описание работы** — НЕТ (только название)
- **Видео** — НЕТ
- **Реальные изображения** — все placeholder
- **Ссылки OpenSea** — все null

---

## Сопоставление: Есть сейчас vs Должно быть

| Аспект | Есть сейчас | Должно быть |
|--------|-------------|-------------|
| **Хранение данных** | JSON (4 NFT) | SQLite БД |
| **Админка** | НЕТ | CRUD: создание, редактирование, удаление |
| **Страница NFT** | Только список | Детальная страница с описанием и видео |
| **Описание** | НЕТ | На 4 языках — **ОБЯЗАТЕЛЬНОЕ поле** |
| **Видео** | НЕТ | Загрузка и воспроизведение — **ОБЯЗАТЕЛЬНОЕ поле** |
| **Изображения** | Placeholder | Реальные изображения — **ОБЯЗАТЕЛЬНОЕ поле** |
| **OpenSea ссылки** | null | Рабочие ссылки на каждый NFT |
| **Количество NFT** | 4 | 5 (добавить спарсенные) |

**URL фронтенда:** https://k-liee.com/en/nft
**OpenSea коллекция:** https://opensea.io/collection/k-lieesculptures
**Админка NFT:** НЕТ (нужно создать)

---

## Что на выходе

1. **Таблица nfts в БД** — структура для хранения NFT
2. **Миграция данных** — из JSON + спарсенные данные
3. **Админка NFT** — CRUD с загрузкой видео/изображений
4. **Фронтенд из БД** — провайдер переключен на SQLite
5. **Страница отдельного NFT** — `/[lang]/nft/[slug]` с описанием и видео
6. **Описание на 4 языках** — перевод английских описаний
7. **Видео работ** — загрузка и воспроизведение
8. **Ссылки OpenSea** — рабочие ссылки для покупки

---

## Что нужно сделать

### 1. Создать таблицу nfts в БД

```sql
CREATE TABLE nfts (
  id INTEGER PRIMARY KEY,
  slug TEXT UNIQUE NOT NULL,

  -- Название (обязательно на всех языках)
  title_en TEXT NOT NULL,
  title_ru TEXT NOT NULL,
  title_es TEXT NOT NULL,
  title_zh TEXT NOT NULL,

  -- Описание (ОБЯЗАТЕЛЬНО на всех языках)
  description_en TEXT NOT NULL,
  description_ru TEXT NOT NULL,
  description_es TEXT NOT NULL,
  description_zh TEXT NOT NULL,

  -- Медиа (ОБЯЗАТЕЛЬНО)
  image_id INTEGER NOT NULL REFERENCES media(id),
  video_id INTEGER NOT NULL REFERENCES media(id),

  -- Дополнительная информация
  technique TEXT,
  year INTEGER,
  price REAL,
  currency TEXT DEFAULT 'ETH',
  opensea_url TEXT,
  blockchain TEXT DEFAULT 'Polygon',

  -- Управление
  is_featured INTEGER DEFAULT 1,
  is_visible INTEGER DEFAULT 1,
  order_index INTEGER DEFAULT 0,
  created_at TEXT DEFAULT CURRENT_TIMESTAMP
);
```

**Обязательные поля:**
- `title_en/ru/es/zh` — название на всех 4 языках
- `description_en/ru/es/zh` — описание на всех 4 языках
- `image_id` — изображение (NOT NULL)
- `video_id` — видео (NOT NULL)

### 2. Создать админку для NFT

**Путь:** `/nft`

Функционал:
- Список NFT с превью
- Создание нового NFT
- **Обязательные поля при создании:**
  - Изображение (загрузка файла)
  - Видео (загрузка файла)
  - Название (4 языка)
  - Описание (4 языка)
- Редактирование существующего
- Ссылка на OpenSea
- Удаление NFT

**Валидация в админке:**
- Нельзя сохранить без изображения
- Нельзя сохранить без видео
- Нельзя сохранить без описания на всех 4 языках

### 3. Миграция данных

**Источники:**
1. `data/nft.json` — 4 NFT (title на 4 языках)
2. `project/nft/nft.md` — 5 NFT (описания EN, ссылки OpenSea)
3. `project/nft/_1_.mp4` ... `_5_.mp4` — видео файлы

**Задачи:**
- Объединить данные из JSON и спарсенных
- Загрузить видео файлы в `/uploads/nft/videos/`
- Сделать скриншоты из видео для изображений (или загрузить отдельно)
- Перевести описания на RU/ES/ZH

### 4. Переключить фронтенд на БД

- Переписать `nft.provider.ts` для работы с БД
- Заменить импорт JSON на запросы к SQLite

### 5. Страница отдельного NFT

**Путь:** `/[lang]/nft/[slug]`

Содержимое:
- Название (мультиязычное)
- Описание (мультиязычное)
- **Видео с плеером** (обязательно)
- **Изображение** (показывается как превью/постер)
- Информация: техника, год, цена
- Кнопка "Buy on OpenSea" (ссылка)
- Кнопка "Назад к списку"

### 6. Перевод описаний

Спарсенные описания только на английском.
Нужно перевести на:
- Русский (RU)
- Испанский (ES)
- Китайский (ZH)

---

## Загрузка медиа — требования

### Видео (ОБЯЗАТЕЛЬНО для каждого NFT)
- Форматы: mp4, webm
- Максимальный размер: 50MB
- Без дублирования (проверка по хэшу)
- Хранение: `/uploads/nft/videos/`
- Валидация: файл должен быть загружен

### Изображения (ОБЯЗАТЕЛЬНО для каждого NFT)
- Оптимизация в webp
- Максимальный размер: 1500x1500px
- Качество: 80-85%
- Без дублирования (проверка по хэшу)
- Хранение: `/uploads/nft/images/`
- Валидация: файл должен быть загружен

### Описания (ОБЯЗАТЕЛЬНО для каждого NFT)
- Все 4 языка должны быть заполнены
- Минимальная длина: 10 символов
- Валидация в форме админки

---

## Факторы реализации

- **Таблица nfts** — создать с нуля (нет в БД)
- **Обязательные поля** — видео, изображение, описание (4 языка)
- **Админка** — создать с нуля с валидацией
- **Спарсенные данные** — готовы к импорту
- **Видео файлы** — готовы (_1_.mp4 ... _5_.mp4)
- **Перевод описаний** — нужен для 3 языков
- **Мультиязычность** — 4 языка (EN/RU/ES/ZH)
- **Темы** — светлая/тёмная работают
- **OpenSea интеграция** — только ссылки (без API)

---

## Критерии успеха

- [ ] Таблица nfts создана в БД с обязательными полями
- [ ] Данные мигрированы (5 NFT)
- [ ] Каждый NFT имеет: изображение, видео, описание (4 языка)
- [ ] Админка: валидация обязательных полей работает
- [ ] Админка: нельзя сохранить без видео/изображения/описания
- [ ] Админка: можно создать новый NFT
- [ ] Админка: можно редактировать существующий
- [ ] Страница NFT: видео воспроизводится
- [ ] Страница NFT: описание на 4 языках
- [ ] Страница NFT: ссылка на OpenSea работает
- [ ] Фронтенд: переключение языков работает
- [ ] Фронтенд: светлая/тёмная тема работает
- [ ] Медиа: без дублирования при загрузке

---

## Чек-лист для проверки в браузере

**Миграция:**
- [ ] Все 5 NFT отображаются на /en/nft
- [ ] У каждого NFT есть изображение (не placeholder)
- [ ] Названия на всех 4 языках корректны
- [ ] Ссылки OpenSea работают

**Админка NFT — валидация обязательных полей:**
- [ ] Попробовать создать NFT без изображения → ошибка
- [ ] Попробовать создать NFT без видео → ошибка
- [ ] Попробовать создать NFT без описания EN → ошибка
- [ ] Попробовать создать NFT без описания RU → ошибка
- [ ] Создать NFT со всеми полями → успех

**Админка NFT — основной функционал:**
- [ ] Открыть раздел управления NFT
- [ ] Создать тестовый NFT (все обязательные поля)
- [ ] Редактировать существующий NFT
- [ ] Загрузить видео файл
- [ ] Загрузить изображение
- [ ] Удалить тестовый NFT

**Страница отдельного NFT:**
- [ ] Кликнуть на NFT → открывается детальная страница
- [ ] Видно название и описание
- [ ] Видео воспроизводится
- [ ] Изображение отображается (как постер)
- [ ] Кнопка "Buy on OpenSea" ведёт на правильную страницу
- [ ] Работает в светлой и тёмной теме
- [ ] Переключение языка работает — описание меняется

**Загрузка медиа:**
- [ ] Загрузить видео → сохраняется корректно
- [ ] Загрузить изображение → оптимизируется в webp
- [ ] Загрузить повторно → НЕ дублируется

---

## Файлы для изменения (предварительно)

| Файл | Изменение |
|------|-----------|
| `src/lib/server/db/schema.ts` | Создать таблицу nfts с обязательными полями |
| `src/lib/data/nft.provider.ts` | Переключить на БД |
| `data/nft.json` | Источник для миграции → бэкап |
| `src/routes/(admin)/nft/+page.svelte` | Создать список NFT |
| `src/routes/(admin)/nft/[id]/+page.svelte` | Создать редактирование с валидацией |
| `src/routes/[lang]/nft/[slug]/+page.svelte` | Создать страницу NFT |
| `src/lib/server/upload.ts` | Добавить поддержку видео |

---

## Данные для миграции

### NFT 1: Ophelia Hamlet Metamorphosis
- **Title EN:** Ophelia Hamlet Metamorphosis Talking to the skull, one foot in the grave
- **Видео:** _1_.mp4
- **OpenSea:** https://opensea.io/item/polygon/0x2953399124f0cbb46d2cbacd8a89cf0599974963/4710524236615757077748399013286708769594205771246107789391314365536557596679

### NFT 2: Woman with a pillow
- **Title EN:** Woman with a pillow
- **Видео:** _2_.mp4
- **OpenSea:** https://opensea.io/item/polygon/0x2953399124f0cbb46d2cbacd8a89cf0599974963/4710524236615757077748399013286708769594205771246107789391314364437045968903

### NFT 3: Squatting down
- **Title EN:** Squatting down
- **Видео:** _3_.mp4
- **OpenSea:** https://opensea.io/item/polygon/0x2953399124f0cbb46d2cbacd8a89cf0599974963/4710524236615757077748399013286708769594205771246107789391314367735580852231

### NFT 4: Cherry
- **Title EN:** Cherry
- **Видео:** _4_.mp4
- **OpenSea:** https://opensea.io/item/polygon/0x2953399124f0cbb46d2cbacd8a89cf0599974963/4710524236615757077748399013286708769594205771246107789391314366636069224455

### NFT 5: Cats
- **Title EN:** Cats
- **Видео:** _5_.mp4
- **OpenSea:** https://opensea.io/item/polygon/0x2953399124f0cbb46d2cbacd8a89cf0599974963/4710524236615757077748399013286708769594205771246107789391314368835092480007

---

*FINAL — одобрено Moderator, готово для Developer*
