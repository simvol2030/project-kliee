# Спецификация: Раздел Works — полноценное управление коллекциями и работами

**Версия:** v3 (после исследования)
**Дата:** 2026-01-08
**Автор:** Moderator → CLI

---

## Текущее состояние (проверено в браузере и коде)

### Хранение данных

| Компонент | Где сейчас | Что нужно |
|-----------|------------|-----------|
| **Коллекции (series)** | JSON файл `data/series.json` | Перенести в БД |
| **Работы (artworks)** | SQLite БД (Drizzle ORM) | Уже в БД |
| **Изображения работ** | SQLite (`artworkImages`, `media`) | Добавить UI для мульти-фото |
| **Связь с магазином** | SQLite (`shopProducts`) | Работает! Доработать UI |

### Что работает на фронтенде

- 8 коллекций отображаются с фото, названием, счётчиком, описанием
- Мультиязычность (4 языка) работает
- Светлая/тёмная тема работает
- При клике на работу — модалка с одним фото, названием, техникой
- Связь с магазином работает (кнопка "Купить" + цена у некоторых работ)

### Что НЕ работает / отсутствует

- **Админка для коллекций** — НЕТ вообще
- **Счётчик работ** — захардкожен в JSON, не динамический
- **Мульти-фото работы** — таблица есть, но UI показывает только одно
- **Описание работы** — в модалке нет (только название + техника)

---

## Сопоставление: Есть сейчас vs Должно быть

| Аспект | Есть сейчас | Должно быть |
|--------|-------------|-------------|
| **Коллекции — хранение** | JSON (`data/series.json`) | SQLite БД |
| **Коллекции — админка** | НЕТ | CRUD: создание, редактирование, удаление |
| **Счётчик работ** | Захардкожен в JSON | Динамический из БД |
| **Фото работы** | Только 1 (primary) в модалке | Все фото из `artworkImages` с перелистыванием |
| **Описание работы** | Нет в модалке | Отображается в модалке |
| **Связь с магазином** | Работает, но нет UI в админке | UI для привязки работы к товару |

**URL фронтенда:** https://k-liee.com/ru/works
**Админка коллекций:** НЕТ (нужно создать)

---

## Что на выходе

1. **Миграция коллекций в БД** — данные из `data/series.json` перенесены в SQLite
2. **Админка для коллекций** — CRUD с мультиязычным вводом (4 языка)
3. **Динамический счётчик** — количество работ считается из БД
4. **Мульти-фото в модалке** — все изображения работы с перелистыванием
5. **Описание работы** — отображается в модалке просмотра
6. **UI связи с магазином** — в админке можно привязать работу к товару

---

## Что нужно сделать

### 1. Миграция коллекций в БД

**Источник:** `data/series.json` (8 коллекций)
**Цель:** Таблица `series` в SQLite

Проверить существующую таблицу `series` в схеме Drizzle:
- Есть ли поля для мультиязычности (title_en, title_ru, title_es, title_zh)?
- Есть ли description на 4 языках?
- Если нет — добавить миграцию

**Важно:** Не потерять существующие данные!

### 2. Админка для коллекций

**Путь:** `/shop/collections` или `/admin/works` (уточнить)

Функционал:
- Список коллекций с превью
- Создание новой коллекции
- Редактирование: фото, название (4 языка), описание (4 языка), порядок
- Удаление коллекции
- Отображение динамического счётчика работ

### 3. Динамический счётчик работ

Заменить захардкоженный `artworkCount` в JSON на:
```sql
SELECT COUNT(*) FROM artworks WHERE series_id = ? AND is_visible = true
```

Обновить `series.provider.ts` для работы с БД вместо JSON.

### 4. Мульти-фото в модалке

Таблица `artworkImages` уже существует. Нужно:
- В `artworks.provider.ts` загружать ВСЕ изображения, не только primary
- В компоненте модалки добавить галерею с перелистыванием
- Стрелки вперёд/назад или точки навигации

### 5. Описание работы в модалке

Добавить в модалку просмотра:
- Название (уже есть)
- Техника (уже есть)
- **Описание** (добавить)
- Год (если есть)
- Размеры (если есть)

### 6. UI связи с магазином (админка)

В редактировании работы добавить:
- Чекбокс "Доступно для продажи"
- Выбор товара из магазина для привязки
- Или автоматическое создание товара

---

## Факторы реализации

- **Не потерять данные** — сначала миграция JSON → БД, потом переключение провайдера
- **Существующая таблица series** — проверить схему, возможно уже частично готова
- **Существующая связь с магазином** — `shopProducts.artwork_id` уже работает
- **Мультиязычность** — 4 языка (EN/RU/ES/ZH) для всех текстов
- **Темы** — светлая/тёмная уже работают, не сломать
- **Пути изображений** — `/images/works/...` для существующих, `/uploads/...` для новых

---

## Критерии успеха

- [ ] Коллекции загружаются из БД (не из JSON)
- [ ] Данные из JSON перенесены без потерь
- [ ] Админка: можно создать новую коллекцию
- [ ] Админка: можно редактировать существующую коллекцию
- [ ] Счётчик работ динамический (из БД)
- [ ] Модалка: отображаются все фото работы с перелистыванием
- [ ] Модалка: отображается описание работы
- [ ] Фронтенд: переключение языков работает
- [ ] Фронтенд: светлая/тёмная тема работает
- [ ] Связь с магазином: можно привязать работу к товару

---

## Чек-лист для проверки в браузере

**Миграция (проверить что данные не потеряны):**
- [ ] Все 8 коллекций отображаются на /ru/works
- [ ] Названия и описания на всех 4 языках корректны
- [ ] Изображения коллекций загружаются
- [ ] Счётчики работ соответствуют реальному количеству

**Админка коллекций:**
- [ ] Открыть раздел управления коллекциями
- [ ] Создать тестовую коллекцию (фото + название RU/EN + описание)
- [ ] Отредактировать существующую коллекцию
- [ ] Удалить тестовую коллекцию
- [ ] Проверить что счётчик работ отображается

**Фронтенд — модалка работы:**
- [ ] Кликнуть на работу с несколькими фото
- [ ] Перелистать все изображения
- [ ] Проверить что видно описание работы
- [ ] Проверить что видна техника и год

**Связь с магазином:**
- [ ] Работа с кнопкой "Купить" ведёт в магазин
- [ ] В админке можно привязать работу к товару

---

## Файлы для изменения (предварительно)

| Файл | Изменение |
|------|-----------|
| `src/lib/server/db/schema.ts` | Проверить/добавить поля series |
| `src/lib/data/series.provider.ts` | Переключить с JSON на БД |
| `data/series.json` | Источник для миграции → потом удалить |
| `src/routes/(admin)/...` | Новый раздел админки для коллекций |
| `src/lib/data/artworks.provider.ts` | Загружать все изображения |
| Компонент модалки | Галерея + описание |

---

*v3 — после исследования браузера и кода, передаётся Moderator для комментариев*
